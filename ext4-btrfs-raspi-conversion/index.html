<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.0109ae7f897db2fecdd6.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}</style><meta name="generator" content="Gatsby 3.14.6"/><style data-styled="" data-styled-version="5.3.3">.isveve{top:0;left:0;margin:0 auto;display:block;width:100%;z-index:1000;background-color:var(--color-primaryAlpha);font-weight:700;}/*!sc*/
@media (min-width:700px){.isveve{position:fixed;}}/*!sc*/
data-styled.g2[id="Header__HeaderWrapper-sc-1glvhxp-0"]{content:"isveve,"}/*!sc*/
.inYMWQ{font-weight:700;margin-left:auto;margin-right:auto;height:60px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;max-width:770px;z-index:1000;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;overflow-x:auto;overflow-y:hidden;white-space:nowrap;padding:0px 10px;}/*!sc*/
data-styled.g3[id="Header__HeaderNav-sc-1glvhxp-1"]{content:"inYMWQ,"}/*!sc*/
.ktaSDK{display:none;-webkit-box-align:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
@media (min-width:700px){.ktaSDK{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}/*!sc*/
data-styled.g4[id="Header__HeaderLinksContainer-sc-1glvhxp-2"]{content:"ktaSDK,"}/*!sc*/
.bBOyCQ{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:var(--color-white);border:0;margin:0;padding:8px 10px;min-width:42px;z-index:10;}/*!sc*/
.Header__HeaderLink-sc-1glvhxp-3 + .Header__HeaderLink-sc-1glvhxp-3{margin-left:0.7rem;}/*!sc*/
data-styled.g5[id="Header__HeaderLink-sc-1glvhxp-3"]{content:"bBOyCQ,"}/*!sc*/
.exYtud{padding-left:0;}/*!sc*/
data-styled.g6[id="Header__HeaderLinkTitle-sc-1glvhxp-4"]{content:"exYtud,"}/*!sc*/
.dNxGjL{display:block;padding-left:0;}/*!sc*/
data-styled.g7[id="Header__HeaderLinkTitleContent-sc-1glvhxp-5"]{content:"dNxGjL,"}/*!sc*/
.vgIyO{padding:4px;height:57px;}/*!sc*/
data-styled.g8[id="Header__HeaderImage-sc-1glvhxp-6"]{content:"vgIyO,"}/*!sc*/
.fHfPfm{position:absolute;left:-999px;width:1px;height:1px;top:auto;color:var(--color-white);background-color:var(--color-grey700);}/*!sc*/
.fHfPfm:focus{display:inline-block;height:auto;width:auto;position:static;padding:20px 10px;}/*!sc*/
data-styled.g10[id="Header__SkipMainContent-sc-1glvhxp-8"]{content:"fHfPfm,"}/*!sc*/
.eDZmPx{z-index:30;top:0px;position:relative;color:var(--color-white);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;background:transparent;border:none;cursor:pointer;padding:8px 12px;outline:none;-webkit-tap-highlight-color:transparent;}/*!sc*/
@media (min-width:700px){.eDZmPx{display:none;}}/*!sc*/
data-styled.g12[id="Header__BurgerButton-sc-1glvhxp-10"]{content:"eDZmPx,"}/*!sc*/
.hVsGbE{width:24px;top:30px;height:2px;background:var(--color-white);position:absolute;left:0;background:var(--color-white);-webkit-transition:all 250ms cubic-bezier(0.86,0,0.07,1);transition:all 250ms cubic-bezier(0.86,0,0.07,1);}/*!sc*/
.hVsGbE::before{content:'';top:-8px;width:24px;height:2px;background:var(--color-white);position:absolute;left:0;-webkit-transform:rotate(0);-ms-transform:rotate(0);transform:rotate(0);-webkit-transition:all 250ms cubic-bezier(0.86,0,0.07,1);transition:all 250ms cubic-bezier(0.86,0,0.07,1);}/*!sc*/
.hVsGbE::after{top:8px;content:'';width:24px;height:2px;background:white;position:absolute;left:0;-webkit-transform:rotate(0);-ms-transform:rotate(0);transform:rotate(0);-webkit-transition:all 250ms cubic-bezier(0.86,0,0.07,1);transition:all 250ms cubic-bezier(0.86,0,0.07,1);}/*!sc*/
data-styled.g13[id="Header__BurgerContent-sc-1glvhxp-11"]{content:"hVsGbE,"}/*!sc*/
.bWcVDq{text-align:left;padding-top:30px;padding-bottom:50px;background-color:var(--color-primary);color:var(--color-white);padding-left:20px;padding-right:20px;margin:0 auto;}/*!sc*/
.bWcVDq nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-flow:row wrap;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;max-width:900px;margin:0 auto;}/*!sc*/
.bWcVDq nav .footer-col{-webkit-flex:1 auto;-ms-flex:1 auto;flex:1 auto;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;padding-right:1em;}/*!sc*/
.bWcVDq a{color:var(--color-white);font-weight:bold;}/*!sc*/
.bWcVDq a:hover{color:var(--color-grey200);}/*!sc*/
.bWcVDq .footer-col > p{margin:0;}/*!sc*/
.bWcVDq .footer-title{font-size:0.83em;margin:0 0 1rem;}/*!sc*/
.bWcVDq .footer-item{color:var(--color-white);}/*!sc*/
.bWcVDq .footer-item a{padding:0.25rem 0;display:block;}/*!sc*/
.bWcVDq .footer-heart{color:var(--color-red);}/*!sc*/
.bWcVDq .footer-item-text{padding:0.1rem 0;color:var(--color-white);}/*!sc*/
.bWcVDq .footer-header{-webkit-order:1;-ms-flex-order:1;order:1;margin:0 0.25rem;margin-right:0.25rem;padding:0.25rem;}/*!sc*/
.bWcVDq .footer-column-items{grid-template-columns:1fr;display:grid;}/*!sc*/
@media (max-width:564px){.bWcVDq .footer-col:first-child{width:100%;}}/*!sc*/
data-styled.g14[id="Footer__FooterWrapper-sc-t92llg-0"]{content:"bWcVDq,"}/*!sc*/
*{box-sizing:border-box;margin:0;padding:0;}/*!sc*/
body{font-family:"Lato",sans-serif;color:var(--color-text);background-color:var(--color-siteBackground);}/*!sc*/
img{max-width:100%;height:auto;vertical-align:middle;border:0;}/*!sc*/
a{-webkit-text-decoration:none;text-decoration:none;color:var(--color-text);}/*!sc*/
hr{border:0;border-top:1px solid var(--color-grey100);margin:50px 0 5px 0;}/*!sc*/
ul,ol{padding-left:2em;margin:1em 0 0 0;}/*!sc*/
*::selection{background-color:var(--color-secondary);}/*!sc*/
data-styled.g15[id="sc-global-jPqRIU1"]{content:"sc-global-jPqRIU1,"}/*!sc*/
.hXAwaq{line-height:1.6;margin:1em 0 0 0;}/*!sc*/
data-styled.g17[id="Commons__Text-sc-1aaxjtz-1"]{content:"hXAwaq,"}/*!sc*/
.eQcigk{display:inline-block;color:var(--color-textSecondary);margin:0 4px;}/*!sc*/
.eQcigk::before{content:'‚Ä¢';}/*!sc*/
data-styled.g18[id="Commons__Bull-sc-1aaxjtz-2"]{content:"eQcigk,"}/*!sc*/
.boWpD{text-transform:uppercase;color:var(--color-textSecondary);}/*!sc*/
data-styled.g19[id="Commons__ReadingTimeContainer-sc-1aaxjtz-3"]{content:"boWpD,"}/*!sc*/
.fPkXAb{margin:0 0;}/*!sc*/
@media (min-width:700px){.fPkXAb{margin:60px 0;}}/*!sc*/
data-styled.g20[id="layout__SiteContent-sc-nrr2ov-0"]{content:"fPkXAb,"}/*!sc*/
.blRFYF{position:relative;border-radius:5px;width:80%;max-width:770px;word-wrap:break-word;background-color:var(--color-wrapperBackground);margin:0px auto 30px auto;top:30px;padding:50px;box-shadow:0 0 0 0,0 6px 12px var(--color-wrapperShadow);}/*!sc*/
@media (max-width:780px){.blRFYF{width:100%;padding:25px;}}/*!sc*/
data-styled.g21[id="Wrapper-sc-xmiwfw-0"]{content:"blRFYF,"}/*!sc*/
.iusuBA{position:relative;display:table;width:100%;height:400px;overflow:hidden;background-repeat:no-repeat;background-position:center;background-size:cover;}/*!sc*/
data-styled.g26[id="Hero__HeroContainer-sc-1wsaguq-0"]{content:"iusuBA,"}/*!sc*/
.iOYmne{display:table-cell;vertical-align:middle;text-align:center;width:100%;}/*!sc*/
data-styled.g27[id="Hero__TitleContainer-sc-1wsaguq-1"]{content:"iOYmne,"}/*!sc*/
.fxLtoB{font-weight:700;font-size:3rem;margin:10px 50px;color:var(--color-white);text-shadow:1px 1px 4px rgba(34,34,34,0.85);}/*!sc*/
data-styled.g28[id="Hero__HeroTitle-sc-1wsaguq-2"]{content:"fxLtoB,"}/*!sc*/
.gmQfMT{display:inline;color:var(--color-textSecondary);}/*!sc*/
data-styled.g30[id="TagList__ListContainer-sc-tgjq80-0"]{content:"gmQfMT,"}/*!sc*/
.bnZZNL{text-transform:uppercase;color:var(--color-textSecondary);}/*!sc*/
.bnZZNL:not(:first-child){margin-left:0.3rem;}/*!sc*/
.bnZZNL:hover{border-bottom:1px dotted var(--color-textSecondary);}/*!sc*/
.bnZZNL:before{content:'#';}/*!sc*/
data-styled.g31[id="TagList__TagListItemLink-sc-tgjq80-1"]{content:"bnZZNL,"}/*!sc*/
.eaeXIz{text-transform:uppercase;color:var(--color-textSecondary);}/*!sc*/
.eaeXIz:not(:first-child){margin-left:0.3rem;}/*!sc*/
.eaeXIz:before{content:'#';}/*!sc*/
data-styled.g32[id="TagList__TagListItem-sc-tgjq80-2"]{content:"eaeXIz,"}/*!sc*/
.hyDSxh .author-image{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;position:absolute;top:-40px;left:50%;margin-left:-40px;width:80px;height:80px;border-radius:100%;overflow:hidden;padding:6px;z-index:2;box-shadow:#ececec 0 0 0 1px;background-color:var(--color-wrapperBackground);}/*!sc*/
.hyDSxh .author-image .img{position:relative;display:block;width:100%;height:100%;background-size:cover;background-position:center center;border-radius:100%;}/*!sc*/
.hyDSxh .author-profile .author-image{position:relative;left:auto;top:auto;width:120px;height:120px;padding:3px;margin:-100px auto 0 auto;box-shadow:none;}/*!sc*/
data-styled.g45[id="Bio__BioWrapper-sc-d7fgaq-0"]{content:"hyDSxh,"}/*!sc*/
.whZwb a{box-shadow:0 2px 0 0 var(--color-secondary);}/*!sc*/
.whZwb a:hover{-webkit-filter:brightness(150%);filter:brightness(150%);box-shadow:none;}/*!sc*/
data-styled.g46[id="Bio__BioText-sc-d7fgaq-1"]{content:"whZwb,"}/*!sc*/
.bVqjBD{color:var(--color-textSecondary);}/*!sc*/
data-styled.g50[id="Time__TimeContainer-sc-1u6vd0l-0"]{content:"bVqjBD,"}/*!sc*/
.dfLhVQ{margin-bottom:2rem;color:var(--color-textSecondary);font-size:0.9em;}/*!sc*/
data-styled.g51[id="ContentHeader__Header-sc-1qtxhip-0"]{content:"dfLhVQ,"}/*!sc*/
.dqHKaT{line-height:1.6;}/*!sc*/
.dqHKaT > h2{color:var(--color-h2);padding-top:3rem;margin-top:3rem;border-top:1px solid #ececec;}/*!sc*/
.dqHKaT > h3{padding-top:3rem;}/*!sc*/
.dqHKaT > p{margin:1em 0 0 0;}/*!sc*/
.dqHKaT a{fill:var(--color-text);box-shadow:0 2px 0 0 var(--color-secondary);}/*!sc*/
.dqHKaT a:hover{-webkit-filter:brightness(150%);filter:brightness(150%);box-shadow:none;}/*!sc*/
.dqHKaT a.anchor,.dqHKaT a.gatsby-resp-image-link{box-shadow:none;}/*!sc*/
.dqHKaT h1 .anchor svg,.dqHKaT h2 .anchor svg,.dqHKaT h3 .anchor svg,.dqHKaT h4 .anchor svg,.dqHKaT h5 .anchor svg,.dqHKaT h6 .anchor svg{visibility:hidden;margin-left:-16px;}/*!sc*/
.dqHKaT h1:hover .anchor svg,.dqHKaT h2:hover .anchor svg,.dqHKaT h3:hover .anchor svg,.dqHKaT h4:hover .anchor svg,.dqHKaT h5:hover .anchor svg,.dqHKaT h6:hover .anchor svg,.dqHKaT h1 .anchor:focus svg,.dqHKaT h2 .anchor:focus svg,.dqHKaT h3 .anchor:focus svg,.dqHKaT h4 .anchor:focus svg,.dqHKaT h5 .anchor:focus svg,.dqHKaT h6 .anchor:focus svg{visibility:visible;}/*!sc*/
.dqHKaT > blockquote{box-sizing:border-box;background-color:var(--color-secondaryContentBackground);border-left:5px solid var(--color-secondary);margin:30px 0px;padding:5px 20px;border-radius:0 8px 8px 0;}/*!sc*/
.dqHKaT > blockquote p{margin:0.8em 0;font-style:italic;}/*!sc*/
.dqHKaT .gatsby-highlight{border-radius:5px;font-size:15px;line-height:1.7;border-radius:10px;overflow:auto;tab-size:1.5em;margin:1.5em -1.5em;}/*!sc*/
@media (max-width:500px){.dqHKaT .gatsby-highlight{border-radius:0;margin-left:-25px;margin-right:-25px;}}/*!sc*/
.dqHKaT .gatsby-highlight > pre{border:0;margin:0;padding:1;}/*!sc*/
.dqHKaT .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;}/*!sc*/
.dqHKaT .gatsby-highlight-code-line{background-color:var(--color-darkBlue);display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:0.75em;border-left:0.25em solid var(--color-yellow);}/*!sc*/
.dqHKaT h1 > code.language-text,.dqHKaT h2 > code.language-text,.dqHKaT h3 > code.language-text,.dqHKaT h4 > code.language-text,.dqHKaT h5 > code.language-text,.dqHKaT h6 > code.language-text,.dqHKaT a > code.language-text,.dqHKaT p > code.language-text,.dqHKaT li > code.language-text,.dqHKaT em > code.language-text,.dqHKaT strong > code.language-text{background:var(--color-beige);color:#222222cc;padding:0 3px;font-size:0.94em;border-radius:0.3rem;word-wrap:break-word;}/*!sc*/
.dqHKaT code{word-wrap:break-word;}/*!sc*/
.dqHKaT table{margin-top:1em;margin-bottom:1em;border-collapse:collapse;overflow:hidden;}/*!sc*/
.dqHKaT table th,.dqHKaT table td{padding:0.5em;background-color:var(--color-secondaryContentBackground);}/*!sc*/
.dqHKaT table tr{border-bottom:2px solid var(--color-white);}/*!sc*/
.dqHKaT table tbody tr:last-child{border-bottom:none;}/*!sc*/
data-styled.g52[id="Content__ContentBody-sc-p0bolz-0"]{content:"dqHKaT,"}/*!sc*/
.iRodyD{padding:0 30px 30px;}/*!sc*/
@media only screen and (max-width:500px){.iRodyD{padding:0;}}/*!sc*/
data-styled.g53[id="Article__ArticleWrapper-sc-jwdbi9-0"]{content:"iRodyD,"}/*!sc*/
.kdBdqo{position:relative;margin:6rem 0 0;padding:3rem 0 0;border-top:1px solid #ececec;}/*!sc*/
data-styled.g54[id="Article__ArticleFooter-sc-jwdbi9-1"]{content:"kdBdqo,"}/*!sc*/
.hBISnt{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;max-width:770px;width:80%;margin:0px auto 30px auto;top:20px;position:relative;}/*!sc*/
@media (max-width:780px){.hBISnt{width:100%;padding:25px;}}/*!sc*/
data-styled.g55[id="PrevNextPost__PreviewContainer-sc-1r1qyep-0"]{content:"hBISnt,"}/*!sc*/
.fouyCU{cursor:pointer;-webkit-flex:1 1 300px;-ms-flex:1 1 300px;flex:1 1 300px;background-color:var(--color-secondaryContentBackground);box-shadow:0 0 0 0,0 6px 12px rgba(0,0,0,0.1);margin:20px 20px;border-radius:5px;}/*!sc*/
.fouyCU:hover{box-shadow:0 0 0 0,0 6px 12px var(--color-grey300);-webkit-transition:all 0.3s ease;transition:all 0.3s ease;-webkit-transform:translate3D(0,-1px,0);-ms-transform:translate3D(0,-1px,0);transform:translate3D(0,-1px,0);}/*!sc*/
@media (min-width:780px){.fouyCU:first-child{margin-left:0;}.fouyCU:last-child{margin-right:0;}}/*!sc*/
data-styled.g56[id="PrevNextPost__Preview-sc-1r1qyep-1"]{content:"fouyCU,"}/*!sc*/
.fFYWvj{width:auto;height:200px;background:#c5d2d9 no-repeat 50%;background-size:cover;border-radius:5px 5px 0 0;}/*!sc*/
data-styled.g57[id="PrevNextPost__PreviewCover-sc-1r1qyep-2"]{content:"fFYWvj,"}/*!sc*/
.jJotXX{padding:20px;}/*!sc*/
.jJotXX header{padding:0 0 10px 0;}/*!sc*/
.jJotXX section{padding-bottom:10px;}/*!sc*/
.jJotXX footer{font-size:0.8em;}/*!sc*/
data-styled.g58[id="PrevNextPost__PreviewContent-sc-1r1qyep-3"]{content:"jJotXX,"}/*!sc*/
</style><title data-react-helmet="true">Converting the Raspberry Pi rootfs to RAID1 btrfs on Ubuntu 20.04 | ifiht-blog</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Lato:400,700&amp;display=swap" rel="stylesheet"/><link data-react-helmet="true" rel="canonical" href="https://ifiht.github.io/ext4-btrfs-raspi-conversion"/><meta data-react-helmet="true" name="description" content="Many guides already exist for configuring a raspberry pi root partition to use btrfs, however there were a few circumstances that basically‚Ä¶"/><meta data-react-helmet="true" property="og:url" content="https://ifiht.github.io/ext4-btrfs-raspi-conversion"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Converting the Raspberry Pi rootfs to RAID1 btrfs on Ubuntu 20.04 | ifiht-blog"/><meta data-react-helmet="true" property="og:description" content="Many guides already exist for configuring a raspberry pi root partition to use btrfs, however there were a few circumstances that basically‚Ä¶"/><meta data-react-helmet="true" property="og:image" content="https://ifiht.github.io/static/b0da2248b1bc007273f727c44ff9c9cf/spirit_of_java_by_meganerid.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="abcdef"/><meta data-react-helmet="true" name="twitter:title" content="Converting the Raspberry Pi rootfs to RAID1 btrfs on Ubuntu 20.04 | ifiht-blog"/><meta data-react-helmet="true" name="twitter:description" content="Many guides already exist for configuring a raspberry pi root partition to use btrfs, however there were a few circumstances that basically‚Ä¶"/><meta data-react-helmet="true" name="twitter:image" content="https://ifiht.github.io/static/b0da2248b1bc007273f727c44ff9c9cf/spirit_of_java_by_meganerid.jpg"/><script data-react-helmet="true" type="application/ld+json">[{"@context":"http://schema.org","@type":"WebSite","url":"https://ifiht.github.io/ext4-btrfs-raspi-conversion","name":"Converting the Raspberry Pi rootfs to RAID1 btrfs on Ubuntu 20.04 | ifiht-blog","alternateName":"Converting the Raspberry Pi rootfs to RAID1 btrfs on Ubuntu 20.04 | ifiht-blog"},{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://ifiht.github.io/ext4-btrfs-raspi-conversion","name":"Converting the Raspberry Pi rootfs to RAID1 btrfs on Ubuntu 20.04 | ifiht-blog","image":"https://ifiht.github.io/static/b0da2248b1bc007273f727c44ff9c9cf/spirit_of_java_by_meganerid.jpg"}}]},{"@context":"http://schema.org","@type":"BlogPosting","url":"https://ifiht.github.io/ext4-btrfs-raspi-conversion","name":"Converting the Raspberry Pi rootfs to RAID1 btrfs on Ubuntu 20.04 | ifiht-blog","alternateName":"Converting the Raspberry Pi rootfs to RAID1 btrfs on Ubuntu 20.04 | ifiht-blog","headline":"Converting the Raspberry Pi rootfs to RAID1 btrfs on Ubuntu 20.04 | ifiht-blog","image":{"@type":"ImageObject","url":"https://ifiht.github.io/static/b0da2248b1bc007273f727c44ff9c9cf/spirit_of_java_by_meganerid.jpg"},"description":"Many guides already exist for configuring a raspberry pi root partition to use btrfs, however there were a few circumstances that basically‚Ä¶","author":{"@type":"Person"},"publisher":{"@type":"Organization"},"mainEntityOfPage":{"@type":"WebSite","@id":"https://ifiht.github.io/ext4-btrfs-raspi-conversion"}}]</script><link rel="icon" href="/favicon-32x32.png?v=a48c3f580f03a9b6b175c59afd67309a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#222222"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a48c3f580f03a9b6b175c59afd67309a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a48c3f580f03a9b6b175c59afd67309a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a48c3f580f03a9b6b175c59afd67309a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a48c3f580f03a9b6b175c59afd67309a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a48c3f580f03a9b6b175c59afd67309a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a48c3f580f03a9b6b175c59afd67309a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a48c3f580f03a9b6b175c59afd67309a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a48c3f580f03a9b6b175c59afd67309a"/><style>html { 
--color-grey100: undefined;
--color-grey200: undefined;
--color-grey300: undefined;
--color-grey400: undefined;
--color-grey500: undefined;
--color-grey600: undefined;
--color-grey700: undefined;
--color-grey800: undefined;
--color-grey900: undefined;
--color-white: undefined;
--color-yellow: undefined;
--color-lightYellow: undefined;
--color-blueGreyed: undefined;
--color-darkBlue: undefined;
--color-beige: undefined;
--color-red: undefined;
--color-text: #3E4047;
--color-textSecondary: #546c77;
--color-siteBackground: #f4f8fb;
--color-wrapperBackground: #ffffff;
--color-secondaryContentBackground: #f7f7f7;
--color-wrapperShadow: #0000001a;
--color-primary: #3E4047;
--color-primaryAlpha: rgba(32, 35, 42, 0.85);
--color-secondary: #ffdc4e;
--color-h2: #3E4047; }</style><link as="script" rel="preload" href="/webpack-runtime-89ab9879ced2b82c52e0.js"/><link as="script" rel="preload" href="/framework-91479aec45331d6bbe1c.js"/><link as="script" rel="preload" href="/app-b8cf455c3f23d1156460.js"/><link as="script" rel="preload" href="/3a2f1ab89072400eb78a258db61265f1964eff8a-816fab8a67945ad9e174.js"/><link as="script" rel="preload" href="/6dae301c9709e8c5899acc3516b7dd8f43382179-0882fb6edd5af5291aeb.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-4803d069f4b1a786db80.js"/><link as="fetch" rel="preload" href="/page-data/ext4-btrfs-raspi-conversion/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1956263691.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4156811642.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>!function(){const e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=localStorage.getItem("color-mode");let t="light";t="string"==typeof r?r:e?"dark":"light";let f=document.documentElement;f.style.setProperty("--initial-color-mode",t),Object.entries({grey100:"#ECECED",grey200:"#CFCFD1",grey300:"#B2B3B5",grey400:"#78797E",grey500:"#3E4047",grey600:"#383A40",grey700:"#25262B",grey800:"#1C1D20",grey900:"#131315",white:"#ffffff",yellow:"#ffdc4e",lightYellow:"#f9e892",blueGreyed:"#546c77",darkBlue:"#022a4b",beige:"#fff9d9",red:"#ff0000",text:{light:"#3E4047",dark:"#ffffff"},textSecondary:{light:"#546c77",dark:"#c6d8e0"},siteBackground:{light:"#f4f8fb",dark:"#3E4047"},wrapperBackground:{light:"#ffffff",dark:"#3E4047"},secondaryContentBackground:{light:"#f7f7f7",dark:"#3a3a3a"},wrapperShadow:{light:"#0000001a",dark:"#00000000"},primary:{light:"#3E4047",dark:"#3E4047"},primaryAlpha:{light:"rgba(32, 35, 42, 0.85)",dark:"rgba(32, 35, 42, 0.85)"},secondary:{light:"#ffdc4e",dark:"#ffdc4e"},h2:{light:"#3E4047",dark:"#ffdc4e"}}).forEach(([e,r])=>{const a="--color-"+e;"object"==typeof r?f.style.setProperty(a,r[t]):f.style.setProperty(a,r)})}();</script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header class="Header__HeaderWrapper-sc-1glvhxp-0 isveve"><nav class="Header__HeaderNav-sc-1glvhxp-1 inYMWQ"><a href="#main-content" class="Header__SkipMainContent-sc-1glvhxp-8 fHfPfm">Skip to main content</a><a aria-label="View home page" class="Header__HeaderLink-sc-1glvhxp-3 Header__HeaderLinkTitle-sc-1glvhxp-4 bBOyCQ exYtud" href="/"><img src="/static/a48c3f580f03a9b6b175c59afd67309a/1b595/ivy-icon.png" alt="ifiht-blog" class="Header__HeaderImage-sc-1glvhxp-6 vgIyO"/><span class="Header__HeaderLinkTitleContent-sc-1glvhxp-5 dNxGjL">ifiht-blog</span></a><div class="Header__HeaderLinksContainer-sc-1glvhxp-2 ktaSDK"><a aria-label="View Blog page" class="Header__HeaderLink-sc-1glvhxp-3 bBOyCQ" href="/">Blog</a><a aria-label="View About page" class="Header__HeaderLink-sc-1glvhxp-3 bBOyCQ" href="/about-gatsby-starter-morning-dew">About</a><a aria-label="View Installation page" class="Header__HeaderLink-sc-1glvhxp-3 bBOyCQ" href="/how-to-install">Installation</a></div><button aria-label="open menu" class="Header__BurgerButton-sc-1glvhxp-10 eDZmPx"><div class="Header__BurgerContent-sc-1glvhxp-11 hVsGbE"></div></button></nav></header><div class="layout__SiteContent-sc-nrr2ov-0 fPkXAb"><div style="background-image:url(&quot;/static/b0da2248b1bc007273f727c44ff9c9cf/spirit_of_java_by_meganerid.jpg&quot;)" class="Hero__HeroContainer-sc-1wsaguq-0 iusuBA"><div class="Hero__TitleContainer-sc-1wsaguq-1 iOYmne"><h1 class="Hero__HeroTitle-sc-1wsaguq-2 fxLtoB">Converting the Raspberry Pi rootfs to RAID1 btrfs on Ubuntu 20.04</h1></div></div><main role="main" id="main-content" class="Wrapper-sc-xmiwfw-0 blRFYF"><article class="Article__ArticleWrapper-sc-jwdbi9-0 iRodyD"><section><header class="ContentHeader__Header-sc-1qtxhip-0 dfLhVQ"><time class="Time__TimeContainer-sc-1u6vd0l-0 bVqjBD">28 June 2020</time><span class="Commons__Bull-sc-1aaxjtz-2 eQcigk"></span><div class="TagList__ListContainer-sc-tgjq80-0 gmQfMT"><a class="TagList__TagListItemLink-sc-tgjq80-1 bnZZNL" href="/tags/gatsby">gatsby</a>, <a class="TagList__TagListItemLink-sc-tgjq80-1 bnZZNL" href="/tags/ubuntu">ubuntu</a>, <a class="TagList__TagListItemLink-sc-tgjq80-1 bnZZNL" href="/tags/btrfs">btrfs</a></div></header><div class="Content__ContentBody-sc-p0bolz-0 dqHKaT"><p>Many guides already exist for configuring a raspberry pi root partition to use btrfs, however there were a few circumstances that basically invalidated all of them:</p><ol><li>I wanted the raspberry pi to run Ubuntu 18.04, both for the 64-bit OS and default btrfs implementation,</li><li>The ubuntu image for the pi4 has completely changed the default /boot volume, and..</li><li>I had to do this all on my Windows laptop, or the pi itself through ssh. </li></ol><p>If for some crazy reason your situation mirrors my own, I hope you find this documentation useful. Feel free to comment below if you have suggestions or improvements to the way I did things üòä</p><p><strong>Formatting the SD card</strong></p><ol><li>I used <a href="https://www.balena.io/etcher/">balenaEtcher</a> to flash the latest pi4-compatible <a href="https://ubuntu.com/download/raspberry-pi">Ubuntu 20.04 64-bit image</a> onto the card. Or, if you‚Äôd prefer an older release: <a href="http://cdimage.ubuntu.com/ubuntu/releases/18.04.5/release/">Ubuntu 18.04 and older</a> (for a good description of hard vs. soft float, see <a href="https://www.raspberrypi.org/forums/viewtopic.php?t=11177">Raspberry Pi Forums</a>. In short, the hard float image will increase your performance by using the pi‚Äôs native hardware abilities.)</li><li>Etcher automatically unmounts the card after it‚Äôs finished, so re-mount and use Disk Management (Windows search bar: <code class="language-text">diskmgmt.msc</code>, choose ‚ÄúRun as Administrator‚Äù) to create <em>two</em> partitions. The first should be the current root partition size (unexpanded) + whatever space you‚Äôd like to add. The second must be formatted <em>without</em> Quick Format, and use all remaining space on the volume. This will take a while.</li><li>Once you‚Äôve created both partitions, delete the first so that the space shows ‚Äúunallocated‚Äù. This will let the pi expand it‚Äôs root partition up to your second placeholder partition. When done, it should look as below: <img src="./formatted.png" alt="Formatted Drive"/></li><li>Before ejecting the SD card, create a blank file named ‚Äússh‚Äù in the boot partition (the only one that will mount on Windows), and remove the extension. This allows us to ssh into the pi on first boot.</li></ol><p><strong>Starting up the pi</strong></p><ol><li>Login to the new raspberry pi. I usually check the router to see what DHCP address it was assigned, do as you like. SSH with <code class="language-text">ubuntu@X.X.X.X</code>, password is also <code class="language-text">ubuntu</code> and will need to be changed.</li><li><em>ENABLE SSH SERVICE</em>, or get locked out the first time you mess up: <code class="language-text">sudo systemctl enable ssh</code></li><li>Check that the your btrfs kernel module is enabled: <code class="language-text">sudo lsmod | grep &quot;^btrfs&quot;</code>, if you get nothing back then <code class="language-text">sudo modprobe btrfs</code>.</li><li>If need be, run a <code class="language-text">sudo apt update &amp;&amp; sudo apt install btrfs-tools</code>, but you should already have them on the system. If you run the command anyways, you‚Äôll change the package to manually installed.</li></ol><p><strong>Configure Partitions</strong></p><ol><li><code class="language-text">sudo fdisk /dev/mmcblk0</code>, then enter ‚Äúp‚Äù to print the existing partitions. If you‚Äôve followed everything up to now, you should see something similar to what‚Äôs below:</li></ol><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Device         Boot    Start      End  Sectors  Size Id Type
/dev/mmcblk0p1 *        2048   526335   524288  256M  c W95 FAT32 (LBA)
/dev/mmcblk0p2        526336 10508287  9981952  4.8G 83 Linux
/dev/mmcblk0p3      10508288 62521343 52013056 24.8G  f W95 Ext&#x27;d (LBA)
/dev/mmcblk0p5      10510336 62521343 52011008 24.8G  7 HPFS/NTFS/exFAT</code></pre></div><ol start="2"><li>Take note of the start block for the root partition (mmcblk0p2), because we‚Äôre about to delete and re-create everything except the boot. This should be fine as long as the starting sector remains unchanged.</li><li>continue to delete (‚Äúd‚Äù is the command) until only partition 1 (mmcblk0p1) is left.</li><li>Create two new partitions with the ‚Äún‚Äù command. Select ‚Äúp‚Äù for primary, and make sure the first <em>starts</em> at the exact same sector as it did before, but for size let‚Äôs increase to slightly less than 1/2 of the space left. Do this by entering <code class="language-text">+14G</code>, where the 14 is roughly your total space in Gigabytes divided by two minus one. It will ask if you want to delete the ext4 signature, select ‚ÄúN‚Äù.</li><li>Create a second partition the same way, using defaults and starting at the sector just after your second partition. Ensure they are exactly the same size (i.e. +14G and +14G, or whatever you chose)</li><li>Check that all your commands executed as expected with ‚Äúp‚Äù again, and you should now have this:</li></ol><div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Device         Boot    Start      End  Sectors  Size Id Type
/dev/mmcblk0p1 *        2048   526335   524288  256M  c W95 FAT32 (LBA)
/dev/mmcblk0p2        526336 29886463 29360128   14G 83 Linux
/dev/mmcblk0p3      29886464 59246591 29360128   14G 83 Linux</code></pre></div><ol start="7"><li>Write your changes and exit with ‚Äúw‚Äù.</li></ol><p><strong>BTRFS Setup</strong></p><p>Enter the following commands in order: </p><ol><li><code class="language-text">sudo mkfs.btrfs /dev/mmcblk0p3</code></li><li><code class="language-text">sudo mkdir /mnt/p3</code></li><li><code class="language-text">sudo mount /dev/mmcblk0p3 /mnt/p3</code></li><li><code class="language-text">sudo rsync -qaHAXS --exclude={&quot;/dev/*&quot;,&quot;/proc/*&quot;,&quot;/sys/*&quot;,&quot;/tmp/*&quot;,&quot;/run/*&quot;,&quot;/mnt/*&quot;,&quot;/media/*&quot;,&quot;/lost+found&quot;,&quot;boot/firmware/*&quot;} / /mnt/p3</code> (you may want to run this command in <code class="language-text">screen</code>, in case you get disconnected)</li><li><code class="language-text">sudo lsblk -f</code> - take from this the <em>UUID</em> of mmcblk0p3, this is what you will use in the below commands instead of my value.</li><li><code class="language-text">sudo nano /boot/firmware/nobtcmd.txt</code> (or <code class="language-text">cmdline.txt</code>, depending on your version), then edit these two values to match: <code class="language-text">root=UUID=520bcef5-5b86-4e6e-a0e7-e271db19a88d rootfstype=btrfs</code></li><li><code class="language-text">sudo nano /etc/fstab</code>, again changing the following line: <code class="language-text">UUID=520bcef5-5b86-4e6e-a0e7-e271db19a88d       /        btrfs  defaults,noatime</code></li><li>Perform one last <code class="language-text">rsync</code> exactly like in step 4, to capture the above changes.</li><li><code class="language-text">sudo reboot</code> - your device will close connection here, if you completed all the steps correctly you should be able to ssh back in within ~2 mins.</li><li><code class="language-text">sudo lsblk -f</code></li><li><code class="language-text">sudo btrfs device add -f /dev/mmcblk0p2 /</code></li><li><code class="language-text">sudo lsblk -f</code></li><li><code class="language-text">sudo btrfs balance start -mconvert=raid1 /</code></li><li><code class="language-text">sudo btrfs balance start -dconvert=raid1 /</code></li></ol><p><strong>Long-Term Stability</strong>
Clone and install <a href="https://github.com/kdave/btrfsmaintenance.git">btrfs maintenance</a>.</p><p><strong>üí°Quick tip:</strong> do NOT use a swap file on root!!!</p></div></section><footer class="Article__ArticleFooter-sc-jwdbi9-1 kdBdqo"><div class="Bio__BioWrapper-sc-d7fgaq-0 hyDSxh"><figure class="author-image"><div alt="Mikal ____" style="background-image:url(&quot;/static/7c21c56a5f7a9625a11af8c88dbe0f22/497c6/avatar.png&quot;)" class="img"></div></figure><section><h4>About the author</h4><p class="Commons__Text-sc-1aaxjtz-1 Bio__BioText-sc-d7fgaq-1 hXAwaq whZwb">
  Mikal ____ is a security-conscious, technologically minded carbon-based lifeform seeking efficiency and higher-
  order solutions to a stochastically governed and little-understood universe.
  </p></section></div></footer></article></main><aside class="Wrapper-sc-xmiwfw-0 blRFYF"><div id="disqus_thread"></div></aside><aside class="PrevNextPost__PreviewContainer-sc-1r1qyep-0 hBISnt"><article class="PrevNextPost__Preview-sc-1r1qyep-1 fouyCU"><a aria-label="View Writing a Gatsby Blog article" href="/writing-this-blog"><div style="background-image:url(&quot;/static/c693e48107bdb95776bf655b4deae751/15300-star-map.jpg&quot;)" class="PrevNextPost__PreviewCover-sc-1r1qyep-2 fFYWvj"></div><div class="PrevNextPost__PreviewContent-sc-1r1qyep-3 jJotXX"><header><h2>Writing a Gatsby Blog</h2></header><section><p>This post serves both to help others duplicate my work, and remind me how I did it myself, if ever I forget. At the bottom I&#x27;ll probably‚Ä¶</p></section><footer><span class="Commons__ReadingTimeContainer-sc-1aaxjtz-3 boWpD">1<!-- --> min read</span><span class="Commons__Bull-sc-1aaxjtz-2 eQcigk"></span><div class="TagList__ListContainer-sc-tgjq80-0 gmQfMT"><span to="/tags/gatsby" class="TagList__TagListItem-sc-tgjq80-2 eaeXIz">gatsby</span>, <span to="/tags/mdx" class="TagList__TagListItem-sc-tgjq80-2 eaeXIz">mdx</span></div></footer></div></a></article><article class="PrevNextPost__Preview-sc-1r1qyep-1 fouyCU"><a aria-label="View Securing Your Website with nftables and Cloudflare article" href="/nftables-cloudflare-secure"><div style="background-image:url(&quot;/static/3da42f9f94e4bf7d1ef5927b43e1347d/ee604/cover-interstellar.png&quot;)" class="PrevNextPost__PreviewCover-sc-1r1qyep-2 fFYWvj"></div><div class="PrevNextPost__PreviewContent-sc-1r1qyep-3 jJotXX"><header><h2>Securing Your Website with nftables and Cloudflare</h2></header><section><p>nftables is still fairly new, fairly tricky to the uninitiated, and fairly  not present  on StackExchange sites... Since nothing I host ever‚Ä¶</p></section><footer><span class="Commons__ReadingTimeContainer-sc-1aaxjtz-3 boWpD">1<!-- --> min read</span><span class="Commons__Bull-sc-1aaxjtz-2 eQcigk"></span><div class="TagList__ListContainer-sc-tgjq80-0 gmQfMT"><span to="/tags/nftables" class="TagList__TagListItem-sc-tgjq80-2 eaeXIz">nftables</span>, <span to="/tags/firewall" class="TagList__TagListItem-sc-tgjq80-2 eaeXIz">firewall</span>, <span to="/tags/cloudflare" class="TagList__TagListItem-sc-tgjq80-2 eaeXIz">cloudflare</span>, <span to="/tags/security" class="TagList__TagListItem-sc-tgjq80-2 eaeXIz">security</span></div></footer></div></a></article></aside></div><footer class="Footer__FooterWrapper-sc-t92llg-0 bWcVDq"><nav><div class="footer-col"><h3 class="footer-title">Mikal ____<!-- --> ¬© <!-- -->2022</h3><p class="footer-item-text">Built with<!-- --> <a class="footer-link" href="https://www.gatsbyjs.org">Gatsby</a>.</p><p class="footer-item-text">Theme using<!-- --> <a class="footer-link" href="https://github.com/maxpou/gatsby-starter-morning-dew">gatsby-starter-morning-dew</a>.</p><p class="footer-item-text">Hosted with<!-- --> <span class="footer-heart" role="img" aria-label="Love">‚ù§</span> <!-- -->by<!-- --> <a class="footer-link" href="https://github.com">GitHub</a>.</p></div><div class="footer-col"><h3 class="footer-title">Explore</h3><div class="footer-column-items"><span class="footer-item"><a class="footer-link" href="/">Blog</a></span><span class="footer-item"><a class="footer-link" href="/about-gatsby-starter-morning-dew">About</a></span><span class="footer-item"><a class="footer-link" href="/how-to-install">Installation</a></span></div></div><div class="footer-col"><h3 class="footer-title">Follow the author</h3><div class="footer-column-items"><span class="footer-item"><a class="footer-link" href="https://github.com/Ifiht" rel="external">GitHub</a></span><span class="footer-item"><a class="footer-link" href="https://ifiht.github.io/" rel="external">Website</a></span></div></div></nav></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/ext4-btrfs-raspi-conversion";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-0d564eb9f8584c6ced6f.js"],"app":["/app-b8cf455c3f23d1156460.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-00fb9c193749f8745c54.js"],"component---src-pages-404-js":["/component---src-pages-404-js-cdbcf602ccef2df1587e.js"],"component---src-templates-blog-list-template-js":["/component---src-templates-blog-list-template-js-258a702a281c81808751.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-4803d069f4b1a786db80.js"],"component---src-templates-page-js":["/component---src-templates-page-js-3c94d44662ad1202e7cb.js"],"component---src-templates-tags-js":["/component---src-templates-tags-js-653bb6fa2a66249ef4d8.js"]};/*]]>*/</script><script src="/polyfill-0d564eb9f8584c6ced6f.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-4803d069f4b1a786db80.js" async=""></script><script src="/6dae301c9709e8c5899acc3516b7dd8f43382179-0882fb6edd5af5291aeb.js" async=""></script><script src="/3a2f1ab89072400eb78a258db61265f1964eff8a-816fab8a67945ad9e174.js" async=""></script><script src="/app-b8cf455c3f23d1156460.js" async=""></script><script src="/framework-91479aec45331d6bbe1c.js" async=""></script><script src="/webpack-runtime-89ab9879ced2b82c52e0.js" async=""></script></body></html>